# apple

## core

### log 

generated by gpt: https://chatgpt.com/c/469ea0fc-8873-46e9-abb6-6dfaf15804d9

### acl 

prompt:

假设你是一个优秀的python专家，现在你将设计一个基于api key的API访问控制系统，该系统具有以下功能：

功能描述：
1. 可以配置api key能访问的api列表，当用户请求api时，判断是否具有访问该api的权限再决定是否放行
2. 可以配置api key可以配置每个api的访问次数，当次数用完时，不再放行
3. 不是所有的api都在api key的访问控制机制下，部分api不需要api key的访问控制，直接放行即可，你需要在代码中体现这一点

技术要求：
0. 这个访问控制系统会用到fastapi应用中，所以你最好通过中间件的方式实现，并提供几个测试用的api，在中间件的实现时，要注意中间件中raise HTTPException会造成Internal Server Error，你留意一下
1. 数据库采用sqlite，
2. 缓存使用内存数据结构（注意并发问题，并且是在asyncio环境下的并发），
3. 除此之外，你需要提供完善的测试用例，请不要使用额外的python测试库，使用原生的unittest框架完成测试工作
4. 读写数据库时都要考虑当前环境为asyncio，而传统方式读写数据库可能阻塞，你要想办法避免这种情况
5. 你需要提供数据库表创建及测试数据需要的代码或脚本，便于我进行测试
6. api key的访问控制系统不应该影响API访问的整体性能，不要因为该机制而对API的访问性能产生明显影响





